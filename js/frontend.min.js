/*! event-organiser 2.5.0 2013-11-19 18:19 */
function eveorg_getParameterByName(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))}function eo_load_map(){for(var a=eventorganiser.map,b=0;b<a.length;b++)if(null!==document.getElementById("eo_venue_map-"+(b+1))){eventorganiser.map[b].markers={};var c=a[b].locations,d={zoom:a[b].zoom,scrollwheel:a[b].scrollwheel,zoomControl:a[b].zoomcontrol,rotateControl:a[b].rotatecontrol,panControl:a[b].pancontrol,overviewMapControl:a[b].overviewmapcontrol,streetViewControl:a[b].streetviewcontrol,draggable:a[b].draggable,mapTypeControl:a[b].maptypecontrol,mapTypeId:google.maps.MapTypeId[a[b].maptypeid]};d=wp.hooks.applyFilters("eventorganiser.google_map_options",d);for(var e=new google.maps.Map(document.getElementById("eo_venue_map-"+(b+1)),d),f=new google.maps.LatLngBounds,g=[],h=0;h<c.length;h++){var i=c[h].lat,j=c[h].lng;if(void 0!==i&&void 0!==j){g.push(new google.maps.LatLng(i,j)),f.extend(g[h]);var k={venue_id:c[h].venue_id,position:g[h],map:e,content:c[h].tooltipContent,icon:c[h].icon};k=wp.hooks.applyFilters("eventorganiser.venue_marker_options",k);var l=new google.maps.Marker(k);eventorganiser.map[b].markers[c[h].venue_id]=l,a[b].tooltip&&google.maps.event.addListener(l,"click",eventorganiser_venue_tooltip)}}c.length>1?e.fitBounds(f):e.setCenter(g[0])}}function eventorganiser_venue_tooltip(){var a=this.getMap(),b=this.getMap().getProjection().fromLatLngToPoint(this.position),c=a.getProjection().fromLatLngToPoint(a.getBounds().getNorthEast()),d=a.getProjection().fromLatLngToPoint(a.getBounds().getSouthWest()),e=Math.pow(2,a.getZoom());b=new google.maps.Point((b.x-d.x)*e,(b.y-c.y)*e),wp.hooks.doAction("eventorganiser.venue_marker_clicked",this);var f=[b.x,b.y];return this.tooltip?(this.tooltip.qtip("api").set("position.target",f),this.tooltip.qtip("show"),void 0):(jQuery(this.getMap().getDiv()).css({overflow:"visible"}),this.tooltip=jQuery("<div />").qtip({content:{text:this.content},border:{radius:4,width:3},style:{classes:"ui-tooltip-shadow",widget:!0},position:{at:"right center",my:"top center",target:f,container:jQuery(this.getMap().getDiv())},show:{ready:!0,event:!1,solo:!0},hide:{event:"mouseleave unfocus"}}),void 0)}var eventorganiser=eventorganiser||{};!function(a){jQuery(document).ready(function(){function b(b){var c=b.categories,d="<select class='eo-cal-filter' id='eo-event-cat'>";d+="<option value=''>"+b.buttonText.cat+"</option>";for(var e=0;e<c.length;e++)d+="<option class='cat-colour-"+c[e].colour+" cat' value='"+c[e].slug+"'>"+c[e].name+"</option>";d+="</select>";var f=a("<span class='fc-header-dropdown filter-category'></span>");return f.append(d),f}function c(){var b=a("<span class='fc-header-goto'><input type='hidden' class='eo-mini-calendar'/></span>");return b}function d(b){var c=b.venues,d="<select class='eo-cal-filter' id='eo-event-venue'>";d+="<option value=''>"+b.buttonText.venue+"</option>";for(var e=0;e<c.length;e++)d+="<option value='"+c[e].term_id+"'>"+c[e].name+"</option>";d+="</select>";var f=a("<span class='fc-header-dropdown filter-venue'></span>");return f.append(d),f}function e(b,c){a.ajax({url:EOAjaxFront.adminajax,dataType:"JSON",data:{action:"eo_widget_agenda",instance_number:c.number,direction:b,start:c.StartDate,end:c.EndDate},success:function(a){return jQuery.isArray(a)&&a[0]?(c.StartDate=a[0].StartDate,c.EndDate=a[a.length-1].StartDate,f(a,c),void 0):!1}})}function f(b,c){var d=a("#"+c.id+"_container"),e=d.find("ul.dates"),f=e.find("li");a(f).remove();var g=!1;for(k=0;k<b.length;k++){var h,i;new Date(b[k].StartDate),(g===!1||g!=b[k].StartDate&&"day"==c.mode)&&(g=b[k].StartDate,h=a('<li class="date" >'+b[k].display+'<ul class="a-date"></ul></li>'),e.append(h)),i=c.add_to_google?a('<li class="event"></li>').append('<span class="cat"></span><span><strong>'+b[k].time+": </strong></span>"+b[k].post_title).append('<div class="meta" style="display:none;"><span>'+b[k].link+"</span><span> Â  </span><span>"+b[k].Glink+"</span></div>"):a('<li class="event"></li>').append("<a class='eo-agenda-event-permalink' href='"+b[k].event_url+"'><span class='cat'></span><span><strong>"+b[k].time+": </strong></span>"+b[k].post_title+"</a>"),i.find("span.cat").css({background:b[k].color}),h.append(i)}f=e.find("li");var j=d.find("ul li.event");j.on("click",function(){a(this).find(".meta").toggle("400")})}if(a("#eo-upcoming-dates").length>0&&a("#eo-upcoming-dates").find("li:gt(4)").length>0){var g=5,h={more:EOAjaxFront.locale.ShowMore,less:EOAjaxFront.locale.ShowLess};a("#eo-upcoming-dates").find("li:gt("+(g-1)+")").hide().end().after(a('<a href="#" id="eo-upcoming-dates-less">'+h.less+'</a> <span id="eo-upcoming-dates-pipe">|</span> <a href="#" id="eo-upcoming-dates-more">'+h.more+"</a>")),a("#eo-upcoming-dates-pipe").hide(),a("#eo-upcoming-dates-less").hide().click(function(b){b.preventDefault();var c=Math.floor((a("#eo-upcoming-dates li:visible").length-1)/g)*g-1;a("#eo-upcoming-dates li:gt("+c+")").hide(),a("#eo-upcoming-dates-more,#eo-upcoming-dates-pipe").show(),a("#eo-upcoming-dates li:visible").length<=g&&a("#eo-upcoming-dates-less,#eo-upcoming-dates-pipe").hide()}),a("#eo-upcoming-dates-more").click(function(b){b.preventDefault(),a("#eo-upcoming-dates-less,#eo-upcoming-dates-pipe, #eo-upcoming-dates li:hidden:lt("+g+")").show();var c=a("#eo-upcoming-dates-pipe").offset();a("html, body").animate({scrollTop:Math.max(c.top+40-a(window).height(),a(window).scrollTop())}),0===a("#eo-upcoming-dates li:hidden").length&&a("#eo-upcoming-dates-more,#eo-upcoming-dates-pipe").hide()})}if(a(".eo-fullcalendar").length>0){for(var i,j=eventorganiser.calendars,k=0;k<j.length;k++){var l="#eo_fullcalendar_"+(k+1);"undefined"==typeof j[k].category&&(j[k].category=""),"undefined"==typeof j[k].venue&&(j[k].venue="");var m={id:l,year:j[k].year?j[k].year:void 0,month:j[k].month?j[k].month:void 0,date:j[k].date?j[k].date:void 0,category:j[k].event_category,venue:j[k].event_venue,customButtons:{category:b,venue:d,"goto":c},theme:j[k].theme,categories:eventorganiser.fullcal.categories,venues:eventorganiser.fullcal.venues,timeFormatphp:j[k].timeformatphp,timeFormat:j[k].timeformat,isRTL:j[k].isrtl,editable:!1,tooltip:j[k].tooltip,firstDay:parseInt(eventorganiser.fullcal.firstDay,10),weekends:j[k].weekends,allDaySlot:j[k].alldayslot,allDayText:j[k].alldaytext,axisFormat:j[k].axisformat,minTime:j[k].mintime,maxTime:j[k].maxtime,columnFormat:{month:j[k].columnformatmonth,week:j[k].columnformatweek,day:j[k].columnformatday},titleFormat:{month:j[k].titleformatmonth,week:j[k].titleformatweek,day:j[k].titleformatday},header:{left:j[k].headerleft,center:j[k].headercenter,right:j[k].headerright},eventRender:function(b,c,d){var e=a(d.calendar.options.id).find(".filter-category .eo-cal-filter").val(),f=a(d.calendar.options.id).find(".filter-venue .eo-cal-filter").val();return"undefined"!=typeof e&&""!==e&&a.inArray(e,b.category)<0?"<div></div>":"undefined"!=typeof f&&""!==f&&f!=b.venue?"<div></div>":wp.hooks.applyFilters("eventorganiser.fullcalendar_render_event",!0,b,c,d)?(d.calendar.options.tooltip&&a(c).qtip({content:{text:b.description,button:"x",title:b.title},position:{my:"top center",at:"bottom center",viewport:a(window),adjust:{method:"shift none"}},hide:{fixed:!0,delay:500,effect:function(){a(this).fadeOut("50")}},border:{radius:4,width:3},style:{classes:"ui-tooltip-shadow",widget:!0,tip:"topMiddle"}}),void 0):"<div></div>"},buttonText:{today:EOAjaxFront.locale.today,month:EOAjaxFront.locale.month,week:EOAjaxFront.locale.week,day:EOAjaxFront.locale.day,cat:EOAjaxFront.locale.cat,venue:EOAjaxFront.locale.venue},monthNames:EOAjaxFront.locale.monthNames,monthNamesShort:EOAjaxFront.locale.monthAbbrev,dayNames:EOAjaxFront.locale.dayNames,dayNamesShort:EOAjaxFront.locale.dayAbbrev,eventColor:"#21759B",defaultView:j[k].defaultview,lazyFetching:"true",events:function(b,c,d,e){var f={start:jQuery.fullCalendar.formatDate(b,"yyyy-MM-dd"),end:jQuery.fullCalendar.formatDate(c,"yyyy-MM-dd"),timeformat:e.timeFormatphp,users_events:e.users_events};"undefined"!=typeof e.category&&""!==e.category&&(f.category=e.category),"undefined"!=typeof e.venue&&""!==e.venue&&(f.venue=e.venue),f=wp.hooks.applyFilters("eventorganiser.fullcalendar_request",f,b,c,d,e),a.ajax({url:eventorganiser.ajaxurl+"?action=eventorganiser-fullcal",dataType:"JSON",data:f,success:d,complete:function(a,b){}})},selectable:!1,weekMode:"variable",aspectRatio:1.5,loading:function(b){var c=a("#"+a(this).attr("id")+"_loading");b?(window.clearTimeout(i),i=window.setTimeout(function(){c.show()},1e3)):(window.clearTimeout(i),c.hide())}};m=wp.hooks.applyFilters("eventorganiser.fullcalendar_options",m,j[k]),a(l).fullCalendar(m)}a(".eo-cal-filter").change(function(){a(".eo-fullcalendar").fullCalendar("rerenderEvents")}),a(".eo-mini-calendar").datepicker({dateFormat:"DD, d MM, yy",changeMonth:!0,changeYear:!0,firstDay:parseInt(eventorganiser.fullcal.firstDay,10),buttonText:EOAjaxFront.locale.gotodate,monthNamesShort:EOAjaxFront.locale.monthAbbrev,dayNamesMin:EOAjaxFront.locale.dayAbbrev,nextText:EOAjaxFront.locale.nextText,prevText:EOAjaxFront.locale.prevText,showOn:"button",beforeShow:function(b,c){c.hasOwnProperty("dpDiv")?c.dpDiv.addClass("eo-datepicker"):a("#ui-datepicker-div").addClass("eo-datepicker")},onSelect:function(b){var c=a(this).parents("div.eo-fullcalendar").attr("id");a("#"+c).fullCalendar("gotoDate",new Date(Date.parse(b)))}})}if(a(".eo_widget_calendar").length>0&&(a(".eo_widget_calendar tfoot").unbind("click"),a(".eo_widget_calendar").off("click").on("click","tfoot a",function(b){b.preventDefault();var c=a(this).closest(".eo_widget_calendar").attr("id"),d={showpastevents:1,"show-long":0,"link-to-single":0};"undefined"!=typeof EOAjax&&"undefined"!=typeof eventorganiser.widget_calendars&&(d=eventorganiser.widget_calendars[c]),"undefined"!=typeof eo_widget_cal&&(d=eo_widget_cal[c]),d.eo_month=eveorg_getParameterByName("eo_month",a(this).attr("href")),a.getJSON(EOAjaxFront.adminajax+"?action=eo_widget_cal",d,function(b){a("#"+c+"_content").html(b)})})),a(".eo-agenda-widget").length>0){for(var n in eo_widget_agenda){n=eo_widget_agenda[n];var o=new Date;n.StartDate=a.fullCalendar.formatDate(o,"yyyy-MM-dd"),n.EndDate=n.StartDate,e(1,n)}a(".eo-agenda-widget .agenda-nav span.button").click(function(b){var c=a(this).parents(".eo-agenda-widget").attr("id");n=eo_widget_agenda[c],b.preventDefault();var d=!1;if(a(this).hasClass("next"))d="+1";else if(a(this).hasClass("prev"))d="-1";else{var f=a(this).parent();d=f.hasClass("prev")?"-1":"+1"}e(d,n)})}})}(jQuery);